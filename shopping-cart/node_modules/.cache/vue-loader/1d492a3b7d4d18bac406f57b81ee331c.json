{"remainingRequest":"/Users/hussainalsabr/Desktop/My Files/Self Development/typescript-projects/Mastering-TypeScript-Fourth-Edition/ch16/shopping-cart/node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!/Users/hussainalsabr/Desktop/My Files/Self Development/typescript-projects/Mastering-TypeScript-Fourth-Edition/ch16/shopping-cart/src/App.vue?vue&type=template&id=7ba5bd90&scoped=true","dependencies":[{"path":"/Users/hussainalsabr/Desktop/My Files/Self Development/typescript-projects/Mastering-TypeScript-Fourth-Edition/ch16/shopping-cart/src/App.vue","mtime":1689980530468},{"path":"/Users/hussainalsabr/Desktop/My Files/Self Development/typescript-projects/Mastering-TypeScript-Fourth-Edition/ch16/shopping-cart/node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/templateLoader.js","mtime":1690034493082},{"path":"/Users/hussainalsabr/Desktop/My Files/Self Development/typescript-projects/Mastering-TypeScript-Fourth-Edition/ch16/shopping-cart/node_modules/cache-loader/dist/cjs.js","mtime":1690034489199},{"path":"/Users/hussainalsabr/Desktop/My Files/Self Development/typescript-projects/Mastering-TypeScript-Fourth-Edition/ch16/shopping-cart/node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js","mtime":1690034493078}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CiAgIDxkaXYgdi1pZj0ibG9hZGluZyIgY2xhc3M9ImxvYWRpbmciPgogICAgICBMb2FkaW5nLi4uCiAgICA8L2Rpdj4KICAgICA8ZGl2IHYtaWY9IiFsb2FkaW5nIiBjbGFzcz0ibG9hZGluZyI+CiAgICAgIDxTaG9wcGluZ0NhcnQgCiAgICAgICAgOmNvbGxlY3Rpb249ImNhcnRJdGVtcyIgCiAgICAgICAgQG9uLXVwZGF0ZS1jYXJ0PSJvblVwZGF0ZUNhcnQiIC8+CiAgICA8L2Rpdj4K"},{"version":3,"sources":["/Users/hussainalsabr/Desktop/My Files/Self Development/typescript-projects/Mastering-TypeScript-Fourth-Edition/ch16/shopping-cart/src/App.vue"],"names":[],"mappings":";GACG,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;MAChC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IACX,CAAC,CAAC,CAAC,CAAC,CAAC;KACJ,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;MACnC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QACV,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QACtB,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;IACpC,CAAC,CAAC,CAAC,CAAC,CAAC","file":"/Users/hussainalsabr/Desktop/My Files/Self Development/typescript-projects/Mastering-TypeScript-Fourth-Edition/ch16/shopping-cart/src/App.vue","sourceRoot":"","sourcesContent":["<template>\n   <div v-if=\"loading\" class=\"loading\">\n      Loading...\n    </div>\n     <div v-if=\"!loading\" class=\"loading\">\n      <ShoppingCart \n        :collection=\"cartItems\" \n        @on-update-cart=\"onUpdateCart\" />\n    </div>\n</template>\n\n<script lang=\"ts\">\nimport { Vue, Options } from 'vue-class-component';\nimport { CartCollection, IProduct } from \"./CartItems\";\nimport ShoppingCart from \"./components/ShoppingCart.vue\";\nimport { ajax } from \"rxjs/ajax\";\nimport { MicroEventBus } from 'micro-event-bus';\nexport let microEventBus: MicroEventBus = (window as any).microEventBus;\n\n// let shoppingCartItems = new CartCollection();\n\n\ninterface IItemData {\n    username: string;\n    productId: number;\n    amount: string;\n}\n\n@Options({\n    components: {\n        ShoppingCart,\n    },\n    mounted() {\n        console.log(`VUE: App:mounted()`);\n        microEventBus.on('add-user-cart-item').subscribe(this.handleAddItemToCart);\n\n        microEventBus.on('user-logged-in').subscribe(this.handleUserLoggedIn);\n\n    }\n})\nexport default class App extends Vue {\n    cartItems!: CartCollection;\n    username!: string;\n    loading: boolean = false;\n    data() {\n        // return {\n        //     cartItems: shoppingCartItems\n        // }\n        return {\n            cartItems: [],\n            username : null,\n            loading: true\n            \n        }\n    }\n    handleUserLoggedIn(event: string) {\n        console.log(`VUE: App.handleUserLoggedIn : ${event}`);\n        this.username = event;\n        this.loading = true;\n        this.fetchData();\n    }\n\n    fetchData() {\n        console.log(`calling ajax with ${this.username}`);\n        ajax.getJSON(`http://127.0.0.1:3000/carts/${this.username}`).subscribe((data) => {\n            console.log(`cart loaded from API`)\n            let cartItems = new CartCollection();\n            cartItems.items = <IProduct[]>data;\n            this.cartItems = cartItems;\n            this.loading = false;\n        }, (error) => {\n            console.log(`VUE: get /carts/(username) error : ${error}`);\n            this.loading = false;\n        }); \n    }\n\n    handleAddItemToCart(data : IItemData) {\n        console.log(`handleAddItemToCart : item : ${JSON.stringify(data)}`);\n        console.log(`calling GET on /products/${data.productId}`);\n        setTimeout(() => {\n            this.loading = true;\n            ajax.getJSON(`http://127.0.0.1:3000/products/${data.productId}`).subscribe((product) => {\n                let productItem = <IProduct>product;\n                productItem.amount = parseInt(data.amount);\n                this.cartItems.items.push(productItem);\n                this.loading = false;\n            }, (error) => {\n                console.log(`VUE: products/${data.productId} : error ${error}`);\n            }); \n\n        }, 200)\n    }\n    \n\n    onUpdateCart() {\n        console.log(`App.onUpdateCart`);\n        let postBody = this.cartItems.getCartItemsPostData();\n        console.log(`postBody : ${JSON.stringify(postBody)}`);\n        this.loading = true;\n        ajax.post(`http://127.0.0.1:3000/carts/${this.username}`, JSON.stringify(postBody) ).subscribe( () => {\n            console.log(`post succeeded`)\n            this.loading = false;\n        }, (error) => {\n            console.log(`VUE: post to /cards/{username} failed : error : ${error}`);\n            this.loading = false;\n        })\n    }\n\n\n\n}\n</script>\n\n<style scoped>\n</style>\n"]}]}